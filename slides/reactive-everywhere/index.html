<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Reactive everywhere?</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <link rel="stylesheet" media="all" charset="utf-8" href="../../shared/frameworks/highlight.js@9.12.0/idea.css" />
        <link rel="stylesheet" media="all" charset="utf-8" href="../../shared/frameworks/reveal.js@3.6.0/reveal.css" />
        <link rel="stylesheet" media="all" charset="utf-8" href="../../shared/frameworks/reveal.js@3.6.0/css/theme/white.css" />
        <link rel="stylesheet" media="all" charset="utf-8" href="../../shared/css/main.css" />

        <script type="text/javascript" charset="UTF-8" src="../../shared/frameworks/highlight.js@9.12.0/highlight.js"></script>
        <script type="text/javascript" charset="UTF-8" src="../../shared/frameworks/reveal.js@3.6.0/head.min.js"></script>
        <script type="text/javascript" charset="UTF-8" src="../../shared/frameworks/reveal.js@3.6.0/reveal.js"></script>
        <script type="text/javascript" charset="UTF-8" src="../../shared/init.js"></script>
        <script type="module" charset="UTF-8" src="../../resources/init-service-worker.js"></script>
    </head>

    <body>
        <div class="reveal">
            <div class="slides">
                <section data-background-image="./images/cosmos-house-milky-way-8862.jpg" data-background-size="cover" data-background-position="50% 50%">
                    <h2 class="c-title--white">Reactive everywhere?</h2>
                    <h3 class="c-title--white">Feedback on how to fetch data reactively</h3>
                </section>

                <section>
                    <h2>Before we start, never forget this mantra</h2>
                    <blockquote>
                        <p>Every program has two purposes: The one for which it was written and another for which it wasn't.</p>
                        <p><i>Alan J. Perlis</i></p>
                    </blockquote>
                </section>

                <!-- Objectives -->
                <section>
                    <section data-background-image="./images/asphalt-blur-clouds-169976.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">Objectives</h2>
                    </section>

                    <section>
                        <h2>Discover what is reactive programming</h2>
                    </section>

                    <section>
                        <h2>Discover the state of reactive everywhere</h2>
                    </section>

                    <section>
                        <h2>Give feedback on solutions I play with</h2>
                    </section>
                </section>

                <!-- What is reactive programming? -->
                <section>
                    <section data-background-image="./images/asphalt-blur-car-290470.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">What is reactive programming?</h2>
                    </section>

                    <section data-background-image="./images/art-artist-background-316466.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2>Definition</h2>
                        <blockquote>Declarative programming paradigm concerned with data streams and the propagation of change</blockquote>
                    </section>

                    <section>
                        <h2>What does it mean?</h2>
                        <ul>
                            <li>Easy to express static data streams (array)</li>
                            <li>Easy to express dynamic data streams (event emitter)</li>
                            <li>It facilitates the automatic propagation of the changed data flow</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Basic use case: a sum</h2>
                        <pre class="c-pre">
            <code class="javascript u-no-max">let a = 5;
let b = 3;
let c = a + b;

// a few moment later
a = 4;
c = a + b; // We should recalculate again</code>
          </pre>
                    </section>

                    <section>
                        <h2>We want something like that:</h2>
                        <img src="./resources/excel-example.png" alt="" />
                    </section>

                    <section>
                        <h2>Intermediate use case: zip</h2>
                        <ul>
                            <li>We have two arrays as input</li>
                            <li>We have an array as output</li>
                            <li>The output array is of grouped elements</li>
                            <li>Ex: zip(['a', 'b'], [1, 2]) -> [ ['a', 1], ['b', 2] ]</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Zip in motion:</h2>
                        <iframe class="c-iframe" src="https://rxmarbles.com/#zip"></iframe>
                    </section>

                    <section>
                        <h2>Nota bene: Zip is a transducer</h2>
                        <ul>
                            <li>Transducers are composable algorithmic transformations.</li>
                            <li>Transducers compose with ordinary function composition.</li>
                        </ul>
                    </section>

                    <section>
                        <h2>
                            According to the
                            <a href="https://www.reactivemanifesto.org/" target="_blank">reactive manifesto</a>
                        </h2>
                        <div>Reactive systems are</div>
                        <ul>
                            <li>Responsive: responds in a timely manner if at all possible</li>
                            <li>Resilient: stays responsive in the face of failure</li>
                            <li>Elastic: stays responsive under varying workload</li>
                            <li>Message driven</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Big picture</h2>
                        <img src="./resources/reactive-streams-at-underscore-scala-user-group-tel-aviv-272015-7-638.jpg" alt="" />
                    </section>

                    <section>
                        <h2>The reactive manifesto is important</h2>
                        <ul>
                            <li>The manifesto is pretty recent: nearly 2014</li>
                            <li>The manifesto is a kind of trend and inspiration</li>
                            <li>All stream influences come from this manifesto</li>
                            <li>A large variety of architecture, consortiums and frameworks were build based on this manifesto</li>
                        </ul>
                    </section>

                    <section>
                        <h2>At the end, we could have reactive stream</h2>
                        <img src="./resources/reactive-stream-flow-interface-behavior.png" alt="" />
                    </section>

                    <section data-background-image="./images/diego-ph-249471-unsplash.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">Reactive Stream are available since Java 9</h2>
                        <a href="https://www.baeldung.com/java-9-reactive-streams" target="_blank" class="c-title--white">https://www.baeldung.com/java-9-reactive-streams</a>
                    </section>

                    <section data-background-image="./images/mike-enerio-87665-unsplash.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">Asynchronous design is smart and efficient</h2>
                    </section>
                </section>

                <!-- Api overview -->
                <section>
                    <section data-background-image="./images/chalk-company-conceptual-533189.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">Api Overview</h2>
                    </section>

                    <section data-background-image="./images/luca-laurence-547660-unsplash.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">On backend side</h2>
                    </section>

                    <section>
                        <h2>Java ecosystem - Spring WebFlux</h2>
                        <ul>
                            <li>Spring frameworks</li>
                            <li>Based on Spring Mono for reactive coding</li>
                            <li>Based on Spring Flux to introduce reactive code for Web controllers</li>
                        </ul>
                    </section>

                    <section>
                        <h2>What is...</h2>
                        <ul>
                            <li>...Mono? <b>Publisher which returns 0 or 1 element</b></li>
                            <li>...Flux? <b>Publisher which returns 0...N element(s)</b></li>
                        </ul>
                        <pre class="c-pre">
            <code class="java u-no-max">Mono&lt;String&gt; mono = Mono.just("Alex");
Mono&lt;String&gt; mono = Mono.empty();
Flux&lt;String&gt; flux = Flux.just("A", "B", "C");
Flux&lt;String&gt; flux = Flux.fromArray(new String[]{"A", "B", "C"});
Flux&lt;String&gt; flux = Flux.fromIterable(Arrays.asList("A", "B", "C"));</code>
          </pre>
                    </section>

                    <section>
                        <h2>Example - basic</h2>
                        <p>Similar to Java Stream except the input could change at anytime (and we could do parallel tasks)</p>
                        <pre class="c-pre">
            <code class="java u-no-max">public Flux&lt;JsonNode&gt; apply(final Flux&lt;ServerSentEvent&lt;JsonNode&gt;&gt; aFlux) {
  return aFlux
	.filter(evt -&gt; evt.data().isPresent())
	.filter(evt -&gt; evt.event()
	.map(evtType -&gt; &quot;data&quot;.equals(evtType).orElse(FALSE));
}</code>
          </pre>
                    </section>

                    <section>
                        <h2>Example - advanced (part I)</h2>
                        <p>From https://www.baeldung.com/spring-webflux</p>
                        <pre class="c-pre">
            <code class="java u-no-max">@RestController
@RequestMapping(&quot;/employees&quot;)
public class EmployeeController {
    private EmployeeRepository employeeRepository;

    public EmployeeController(EmployeeRepository employeeRepository) {
        this.employeeRepository = employeeRepository;
    }

    @GetMapping(&quot;/{id}&quot;)
    private Mono&lt;Employee&gt; getEmployeeById(@PathVariable String id) {
        return employeeRepository.findEmployeeById(id);
    }

    @GetMapping
    private Flux&lt;Employee&gt; getAllEmployees() {
        return employeeRepository.findAllEmployees();
    }
}</code>
          </pre>
                    </section>

                    <section>
                        <h2>Example - advanced (part II)</h2>
                        <p>From https://www.baeldung.com/spring-webflux</p>
                        <pre class="c-pre">
            <code class="java u-no-max">@Repository
public class EmployeeRepository {
    static Map&lt;String,Employee&gt; employeeData;
    static Map&lt;String,String&gt; employeeAccessData;

    static
    {
    // ...
    }

    public Mono&lt;Employee&gt; findEmployeeById(String id) {
        return Mono.just(employeeData.get(id));
    }

    public Flux&lt;Employee&gt; findAllEmployees() {
        return Flux.fromIterable(employeeData.values());
    }
}</code>
          </pre>
                    </section>

                    <section data-background-image="./images/luca-laurence-547660-unsplash.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">On frontend side</h2>
                    </section>

                    <section>
                        <h2>JavaScript ecosystem</h2>
                        <ul>
                            <li>CycleJs</li>
                            <li>RxJs (natively used in Angular)</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Example - basics</h2>
                        <p>Here how to deal with an autocomplete</p>
                        <pre class="c-pre">
              <code class="javascript u-no-max">const searcher = Rx.Observable
  .fromEvent(document.querySelector('input'), 'keyup')
  .map((e) => e.target.value) // Project the text from the input
  .filter((text) => text.length > 2) // Only if the text is longer than 2 characters
  .debounce(750 /* Pause for 750ms */ )
  .distinctUntilChanged(); // Only if the value has changed

searcher.subscribe(
  (term) =>
	console.info('We should raise a search for:', term);
  },
  console.error
);</code>
          </pre>
                    </section>

                    <section>
                        <h2>In motion</h2>
                        <iframe class="c-iframe" src="https://jsfiddle.net/rochejul/pgcvquz0/embedded/result/"></iframe>
                    </section>

                    <section>
                        <h2>Example - advanced (part I)</h2>
                        <pre class="c-pre">
            <code class="javascript u-no-max">@Injectable({
  providedIn: 'root'
})
export class EmployeeService {

  constructor(
    private httpClient: HttpClient
  ) { }

  getEmployees(): Observable&lt;Employee[]&gt; {
    return this.httpClient.get&lt;Employee[]&gt;('/employees');
  }
}</code>
          </pre>
                    </section>

                    <section>
                        <h2>Example - advanced (part II)</h2>
                        <pre class="c-pre">
            <code class="javascript u-no-max">@Component({ /*...*/ })
export class EmployeeComponent {
  employees: Employee[] = [];
  isError = false;

  constructor(
    private employeeService: EmployeeService
  ) { }

  load() {
    this.employeeService
      .getEmployees()
      .subscribe(
        (employees) =&gt; this.employees = employees,
        (err) =&gt; {
          console.error(err);
          this.isError = true;
        }
      );
  }
}</code>
          </pre>
                    </section>
                </section>

                <!-- So are we reactive everywhere? -->
                <section>
                    <section data-background-image="./images/ask-blackboard-356079.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">So are we reactive everywhere?</h2>
                    </section>

                    <section data-background-image="./images/doctor-who-no.webp" data-background-size="cover" data-background-position="50% 50%"></section>

                    <section>
                        <h2>Most illustrated uses cases are simple</h2>
                        <ol>
                            <li>Fetch data into a database</li>
                            <li>Send the data</li>
                            <li>Display the data</li>
                        </ol>
                    </section>

                    <section>
                        <h2>Most of the time, this is fine</h2>
                    </section>

                    <section>
                        <h2>But the goal of reactive is to deliver data on demand</h2>
                        <h3>Here an interesting use case</h3>
                        <ol>
                            <li>Connect to various systems to search some results</li>
                            <li>Each system delivers data with some latencies</li>
                            <li>Transmit chuncks of results</li>
                            <li>Display the data and refresh the ui on each chuncks</li>
                        </ol>
                    </section>

                    <section data-background-image="./images/anime-art-artistic-262272.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">And here comes troubles</h2>
                    </section>

                    <section data-background-image="./images/business-cabinet-data-325229.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">Who still holds out the invader?</h2>
                        <h3 class="c-title--white">The network!</h3>
                    </section>

                    <section>
                        <h2>Indeed</h2>
                        <p>Backend is streamed, frontend is streamed, but not the network</p>
                        <img src="./resources/stream-big-picture.png" alt="" />
                    </section>

                    <section>
                        <h2>Illustration</h2>
                        <p>Give some latency on backend side on a classical use case</p>
                        <pre class="c-pre">
            <code class="java u-no-max">public Mono&lt;Employee&gt; findEmployeeById(String id) {
        return Mono.just(employeeData.get(id))
              .delayElements(java.util.Duration.ofSeconds(2));
}</code>
          </pre>
                    </section>

                    <section>
                        <h2>In motion</h2>
                        <p>The frontend application will apply reactively only when all data is fetched</p>
                        <video controls autoplay="autoplay" width="900">
                            <source src="./resources/1-classical-way.webm" type="video/webm" />
                            <source src="./resources/1-classical-way.mp4" type="video/mp4" />
                        </video>
                    </section>
                </section>

                <!-- Could we find a solution? -->
                <section data-background-image="./images/black-and-white-black-and-white-challenge-262488.jpg" data-background-size="cover" data-background-position="50% 50%">
                    <h2 class="c-title--white">Could we find a solution?</h2>
                </section>

                <!-- Of course-->
                <section data-background-image="./images/street-fighter-of-course.webp" data-background-size="contain" data-background-position="50% 50%"></section>

                <!-- Overview -->
                <section>
                    <section data-background-image="./images/above-abstract-architecture-450596.jpg" data-background-size="contain" data-background-position="50% 50%">
                        <h2 class="c-title--white">Overview</h2>
                    </section>

                    <section data-background-image="./images/blazer-board-button-39604.jpg" data-background-size="contain" data-background-position="50% 50%">
                        <h2>Ajax polling</h2>
                    </section>

                    <section>
                        <h2>The idea</h2>
                        <ul>
                            <li>Send a first request to initiate the treatment and retrieve a request token</li>
                            <li>Polling the backend with this token to fetch new entries</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Pros</h2>
                        <ul>
                            <li>Simple to put in place on frontend side</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Cons</h2>
                        <ul>
                            <li>Statefull</li>
                            <li>Consumes a lot of bandwidth</li>
                            <li>Consumes a lot of memory</li>
                            <li>Not really real time</li>
                        </ul>
                    </section>

                    <section data-background-image="./images/blazer-board-button-39604.jpg" data-background-size="contain" data-background-position="50% 50%">
                        <h2>HTTP Push server</h2>
                        <h3>Server-side event</h3>
                    </section>

                    <section>
                        <h2>The idea</h2>
                        <ul>
                            <li>Send a first request to initiate the treatment</li>
                            <li>Backend will send a push message each time we have retrieved data</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Pros</h2>
                        <ul>
                            <li>Simple to put in place on frontend side (again)</li>
                            <li>Simple to put in place on backend side</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Cons</h2>
                        <ul>
                            <li>JavaScript global event (so everyone could intercept it into the page)</li>
                            <li>Needs HTTP/2</li>
                            <li><b>Not considered as a good practice to use it</b></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Really</h2>
                        <blockquote>
                            <p>To summarize: there is no one good strategy on how to make best use of this feature of HTTP/2 and everyone is still experimenting</p>
                            <p>
                                <i>Into some <a href="https://httpd.apache.org/docs/2.4/en/howto/http2.html#push" target="_blank">HTTP2 documentation</a></i>
                            </p>
                        </blockquote>
                    </section>

                    <section data-background-image="./images/stupid.webp" data-background-size="contain" data-background-position="50% 50%"></section>

                    <section data-background-image="./images/blazer-board-button-39604.jpg" data-background-size="contain" data-background-position="50% 50%">
                        <h2>WebSocket / MQTT</h2>
                    </section>

                    <section>
                        <h2>WebSocket principles</h2>
                        <img src="./resources/websocket-comparison.png" alt="" />
                    </section>

                    <section>
                        <h2>WebSocket principles</h2>
                        <img src="./resources/websocket-bandwith.gif" alt="" />
                    </section>

                    <section>
                        <h2>WebSocket principles</h2>
                        <img src="./resources/websocket-principles.png" alt="" />
                    </section>

                    <section>
                        <h2>The idea</h2>
                        <ul>
                            <li>Send a Websocket message to start the treatment</li>
                            <li>The backend emits the chunck each time we need it, and only for the client</li>
                            <li>The backend emits a dedicated message to notify when there is no more chuncks</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Pros</h2>
                        <ul>
                            <li>Real realtime</li>
                            <li>Pretty fast</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Cons</h2>
                        <ul>
                            <li>Be careful with load balancer</li>
                            <li>Could be "complex" to put in place</li>
                            <li>Need to notify the backend when the client does not want to have more chuncks</li>
                        </ul>
                    </section>

                    <section data-background-image="./images/mr-bean-frustation.webp" data-background-size="contain" data-background-position="50% 50%">
                        <h2>Quite frustating, huh?</h2>
                    </section>
                </section>

                <!-- We have a simple solution -->
                <section>
                    <section data-background-image="./images/blue-brick-wall-chair-1282315.jpg" data-background-size="contain" data-background-position="50% 50%">
                        <h2>We have a simple solution</h2>
                    </section>

                    <section data-background-image="./images/blue-brick-wall-chair-1282315.jpg" data-background-size="contain" data-background-position="50% 50%">
                        <h2>Use of Ajax</h2>
                    </section>

                    <section data-background-image="./images/chris_tucker-maaaan.webp" data-background-size="contain" data-background-position="50% 50%"></section>

                    <section data-background-image="./images/blue-brick-wall-chair-1282315.jpg" data-background-size="contain" data-background-position="50% 50%">
                        <h2>I mean</h2>
                        <h3>Use of XHR2</h3>
                    </section>

                    <section>
                        <h2>Due to HTML5, the XHR has evolved many times</h2>
                        <ul>
                            <li>In 2012</li>
                            <li>In 2016</li>
                            <li>
                                And still evolves:
                                <a href="https://xhr.spec.whatwg.org/" target="_blank">https://xhr.spec.whatwg.org/</a>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h2>Fun fact (or not)</h2>
                        <ul>
                            <li>XHR was created in 1999 by IE team</li>
                            <li>First W3C draft: 2006</li>
                            <li>First W3C release: 2009</li>
                        </ul>
                    </section>

                    <section>
                        <h2>And browsers welly integrated it</h2>
                        <img src="./images/xhr2-support.png" alt="" />
                    </section>

                    <section data-background-image="./images/luca-laurence-547660-unsplash.jpg" data-background-size="contain" data-background-position="50% 50%">
                        <h2 class="c-title--white">XHR2 features</h2>
                    </section>

                    <section>
                        <h2>CORS: evolution</h2>
                        <p class="c-layout--text-left">Requested server could allow the call from another domain</p>
                        <p class="c-layout--text-left">Example of HTTP header</p>
                        <pre class="c-pre">
            <code class="u-no-max">Access-Control-Allow-Origin: http://example.com</code>
          </pre>
                    </section>

                    <section>
                        <h2>New formats</h2>
                        <ul class="c-layout--text-left">
                            <li>As request / response: at the beginning, only text (or XML)</li>
                            <li>
                                <div>Now we could use</div>
                                <ul>
                                    <li>text</li>
                                    <li>ArrayBuffer</li>
                                    <li>Blob (especially for image)</li>
                                    <li>Document (XML)</li>
                                    <li>FormData (request only)</li>
                                </ul>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h2>New format example (with Blob)</h2>
                        <pre class="c-pre">
            <code class="javascript u-no-max">const xhr = new XMLHttpRequest();
xhr.open('GET', '/path/to/image.png', true);
xhr.responseType = 'blob';
xhr.onload = function(e) {
  if (this.status == 200) {
    const blob = new Blob([this.response], {type: 'image/png'});
    // ...
  }
};
xhr.send();</code>
          </pre>
                    </section>

                    <section>
                        <h2>New format example (with FormData)</h2>
                        <p>Ease generation of application/x-www-form-urlencoded content</p>
                        <pre class="c-pre">
            <code class="javascript u-no-max">function sendForm() {
  const formData = new FormData();
  formData.append('username', 'johndoe');
  formData.append('id', 123456);

  const xhr = new XMLHttpRequest();
  xhr.open('POST', '/server', true);
  xhr.onload = function(e) { /* ... */ };
  xhr.send(formData);
}</code>
          </pre>
                    </section>
                </section>

                <!-- And here come the progress event -->
                <section>
                    <section data-background-image="./images/abstract-art-astronomy-1252890.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">And here come the progress event</h2>
                    </section>

                    <section>
                        <h2>We have the ability to follow the upload / download progression</h2>
                        <p>Most used case: follow file uploading / downloading</p>
                    </section>

                    <section>
                        <h2>Example</h2>
                        <pre class="c-pre">
            <code class="javascript u-no-max">function upload() {
  const xhr = new XMLHttpRequest();
  xhr.open('GET', '/server', true);
  xhr.onload = function(e) { ... };

  // Listen to the upload progress.
  const progressBar = document.querySelector('progress');
  xhr.onprogress = function(e) { // could be too xhr.upload.onprogress
    if (e.lengthComputable) {
      progressBar.value = (e.loaded / e.total) * 100;
    }
  };

  xhr.send(null);
}

upload();</code>
          </pre>
                    </section>

                    <section>
                        <h2>In motion</h2>
                        <iframe class="c-iframe" src="https://1b8rq.sse.codesandbox.io/"></iframe>
                    </section>
                </section>

                <!-- What is the idea? -->
                <section>
                    <section data-background-image="./images/asphalt-dark-dawn-531321.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">What is the idea?</h2>
                    </section>

                    <section data-background-image="./images/attractive-beauty-black-and-white-255268.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">Could we stream JSON?</h2>
                        <h3 class="c-title--white">Spoiler alert: yes</h3>
                    </section>

                    <section>
                        <h2>application/stream+json</h2>
                        <p>Instead sending the whole json, we send JSON chuncks</p>
                        <p>For an array, we will send each entry</p>
                    </section>

                    <section>
                        <h2>What does it mean?</h2>
                        <p>We have to detect each chunck with the progress event</p>
                        <p>(Because the payload will be malformed)</p>
                        <p>
                            <b>(For an array, we will have each entries without the brackets)</b>
                        </p>
                    </section>

                    <section>
                        <h2>What to do on backend side?</h2>
                        <p>On backend, we use Spring Web Flux</p>
                        <p>Good news, this is already stream+json compatible</p>
                        <p>(The "Accept" header should contains "application/stream+json")</p>
                    </section>

                    <section data-background-image="./images/antonio-banderas-happy.webp" data-background-size="contain" data-background-position="50% 50%"></section>

                    <section>
                        <h2>What to do on frontend side?</h2>
                        <p>Sadly, means we have to use XHR directly</p>
                        <p>(No Fetch api, and most of high level frameworks does not deal with progress event)</p>
                        <p>Need some code, but quite doable</p>
                    </section>

                    <section>
                        <h2>Example</h2>
                        <pre class="c-pre">
            <code class="javascript u-no-max">let streamed = 0;
const xhr = new XMLHttpRequest(); // Deal all XHR cases (failures, etc...)
xhr.onprogress = function(e) {
   let chunck = xhr.responseText.substr(streamed;
   logElement.innerText += `${chunck}
`;
   streamed = xhr.responseText.length;
   // Do some code again for parsing, etc...
};

xhr.open("GET", "/employees");
xhr.send(null);</code>
          </pre>
                    </section>

                    <section>
                        <h2>In motion</h2>
                        <iframe class="c-iframe" src="https://r4mjy.sse.codesandbox.io/"></iframe>
                    </section>

                    <section>
                        <h2>Hold on!</h2>
                        <h3>We have a library</h3>
                    </section>

                    <section data-background-image="./images/carlton-happy.webp" data-background-size="contain" data-background-position="50% 50%"></section>

                    <section>
                        <h2>Oboe.js</h2>
                        <ul>
                            <li>Works on NodeJS and browsers (works on IE10)</li>
                            <li>Licence BSD</li>
                            <li>Ligthweight (4.9k)</li>
                            <li>Pretty simple</li>
                            <li>
                                <a href="http://oboejs.com/" target="_blank">http://oboejs.com/</a>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h2>Little example</h2>
                        <pre class="c-pre">
            <code class="javascript u-no-max">oboe('/myapp/things.json')
   .done(function(things) {

      // we got it
   })
   .fail(function() {

      // we don't got it
   });</code>
          </pre>
                    </section>

                    <section>
                        <h2>And in our case?</h2>
                        <pre class="c-pre">
            <code class="javascript u-no-max">@Injectable({
  providedIn: 'root'
})
export class EmployeeService {
  getEmployees(): Observable&lt;Employee&gt; {
    const employees$ = new BehaviorSubject(null);
    const oboeInstance = oboe({
      url: '/employees',
      headers: {
        'Accept': 'application/stream+json'
      }
    });

    oboeInstance
      .done((employee) => employees$.next(employee))
      .fail((err) => employees$.error(err))
      .addListener('end', () => employees$.complete());

    return employees$.pipe(
      filter((employee) => !!employee)
    );
  }
}</code>
          </pre>
                    </section>

                    <section>
                        <h2>Step 1: create a BehaviorSubject and Oboe instance</h2>
                        <p>BehaviorSubject is an RxJs Observable where we could change the current value</p>
                        <pre class="c-pre">
            <code class="javascript u-no-max">const employees$ = new BehaviorSubject(null);
const oboeInstance = oboe({
   url: '/employees',
   headers: {
      'Accept': 'application/stream+json'
   }
});</code>
          </pre>
                    </section>

                    <section>
                        <h2>Step 2: intercept each chunck</h2>
                        <p>If an error occurs or the request is finished, we close the BehaviorSubject</p>
                        <pre class="c-pre">
            <code class="javascript u-no-max">oboeInstance
   .done((employee) => employees$.next(employee))
   .fail((err) => employees$.error(err))
    .addListener('end', () => employees$.complete());</code>
          </pre>
                    </section>

                    <section>
                        <h2>Step 3: change the method signature</h2>
                        <p>Instead having an observable or employees, we have an observable of employee</p>
                        <pre class="c-pre">
            <code class="javascript u-no-max">getEmployees(): Observable&lt;Employee&gt; {</code>
          </pre>
                    </section>

                    <section>
                        <h2>At the end, a little change on our component</h2>
                        <pre class="c-pre">
            <code class="javascript u-no-max">@Component({ /*...*/ })
export class EmployeeComponent {
  employees: Employee[] = [];
  isError = false;

  constructor(
    private employeeService: EmployeeService
  ) { }

  load() {
    this.employeeService
      .getEmployees()
      .subscribe(
        (employee) =&gt; this.employees.push(employee), // pretty simple huh?
        (err) =&gt; {
          console.error(err);
          this.isError = true;
        }
      );
  }
}</code>
          </pre>
                    </section>

                    <section>
                        <h2>Et voilà!</h2>
                        <video controls autoplay="autoplay" width="900">
                            <source src="./resources/3-reactive-over-http.webm" type="video/webm" />
                            <source src="./resources/3-reactive-over-http.mp4" type="video/mp4" />
                        </video>
                    </section>
                </section>

                <!-- Pros and cons -->
                <section>
                    <section data-background-image="./images/asphalt-dark-dawn-531321.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">Pros and cons</h2>
                    </section>

                    <section>
                        <h2>Solution</h2>
                    </section>

                    <section>
                        <h2>Pros</h2>
                        <ul class="c-layout--text-left">
                            <li>Backend: frameworks deal with application/stream+json</li>
                            <li>Backend: easy to deal with non-streamed and streamed json</li>
                            <li>Frontend: frameworks to digest the streamed json</li>
                            <li>Frontend: isolation (based on an Ajax call)</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Cons</h2>
                        <ul class="c-layout--text-left">
                            <li>Backend: needs to be design to be hardly streamed</li>
                            <li>Frontend: cannot be used with the Fetch API (for the moment)</li>
                            <li>Frontend: without framework, need some boilerplate code</li>
                            <li>Frontend: better if we can use some Observable</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Api Fetch: little focus</h2>
                        <p>New JavaScript Api to replace Ajax as meta api</p>
                        <p>Based on Promise</p>
                        <pre class="c-pre">
            <code class="javascript u-no-max">fetch('flowers.jpg', { method: 'GET' })
	.then((response) => response.blob())
	.then((myBlob) => {
	  const objectURL = URL.createObjectURL(myBlob);
	  myImage.src = objectURL;
	});</code>
          </pre>
                    </section>

                    <section>
                        <h2>Oboe.js</h2>
                    </section>

                    <section>
                        <h2>Pros</h2>
                        <ul class="c-layout--text-left">
                            <li>OpenSource (BSD 2)</li>
                            <li>Works for NodeJs and browsers</li>
                            <li>Small (gzipped: 4.9k)</li>
                            <li>Advanced API to extract easily what we want into the streamed JSON</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Cons</h2>
                        <ul class="c-layout--text-left">
                            <li>Last commit: 17 May 2018</li>
                            <li>50k on NPM each week: not bad but could be better</li>
                        </ul>
                    </section>
                </section>

                <!-- Nota Bene -->
                <section>
                    <section data-background-image="./images/diego-ph-249471-unsplash.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">Nota Bene</h2>
                    </section>

                    <section>
                        <h2>Our use case comes from a full reactive system</h2>
                    </section>

                    <section data-background-image="./images/aiden-marples-713-unsplash.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">However don't forget that we could use streams</h2>
                        <h2 class="c-title--white">piece by piece</h2>
                    </section>

                    <section data-background-image="./images/action-asphalt-blur-315938.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">And at the end, have a smart system</h2>
                    </section>
                </section>

                <!-- Resources -->
                <section>
                    <section data-background-image="./images/blur-book-stack-books-590493.jpg" data-background-size="cover" data-background-position="50% 50%">
                        <h2 class="c-title--white">Resources</h2>
                    </section>

                    <section>
                        <h2>Reactive basics</h2>
                        <ul>
                            <li>
                                <a href="https://www.reactivemanifesto.org/" target="_blank">https://www.reactivemanifesto.org/</a>
                            </li>
                            <li>
                                <a href="https://www.reactive-streams.org/" target="_blank">https://www.reactive-streams.org/</a>
                            </li>
                            <li>
                                <a href="https://www.baeldung.com/java-9-reactive-streams" target="_blank">https://www.baeldung.com/java-9-reactive-streams</a>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h2>André Stalz</h2>
                        <ul>
                            <li>
                                Creator of
                                <a href="https://cycle.js.org/" target="_blank">CycleJs</a>
                            </li>
                            <li>
                                <div>Good slides and video around reactive programming</div>
                                <ul>
                                    <li>
                                        Egghead:
                                        <a href="https://egghead.io/courses/introduction-to-reactive-programming" target="_blank"
                                            >https://egghead.io/courses/introduction-to-reactive-programming</a
                                        >
                                    </li>
                                    <li>
                                        DotJs 2015:
                                        <a href="https://www.dotconferences.com/2015/12/andre-medeiros-the-whole-future-declared-in-a-var" target="_blank"
                                            >https://www.dotconferences.com/2015/12/andre-medeiros-the-whole-future-declared-in-a-var</a
                                        >
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754" target="_blank">The introduction to Reactive Programming you've been missing</a>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h2>Java</h2>
                        <ul>
                            <li>
                                <a href="https://github.com/ReactiveX/RxJava/wiki/Creating-Observables">RxJava</a>
                            </li>
                            <li><a href="https://vertx.io/">Vertx</a></li>
                            <li>
                                <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">Spring WebFlux</a>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h2>JavaScript</h2>
                        <ul>
                            <li><a href="http://baconjs.github.io/">BaconJs</a></li>
                            <li><a href="https://cycle.js.org/">CycleJs</a></li>
                            <li><a href="https://rxjs-dev.firebaseapp.com/">RxJs</a></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Training</h2>
                        <ul>
                            <li>
                                <a href="https://egghead.io/courses/asynchronous-programming-the-end-of-the-loop" target="_blank"
                                    >https://egghead.io/courses/asynchronous-programming-the-end-of-the-loop</a
                                >
                            </li>
                            <li>
                                <a href="https://www.learnrxjs.io/" target="_blank">https://www.learnrxjs.io/</a>
                            </li>
                            <li>
                                <a href="https://www.pluralsight.com/courses/rxjs-getting-started" target="_blank">https://www.pluralsight.com/courses/rxjs-getting-started</a>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h2>Misc.</h2>
                        <ul>
                            <li>
                                <a href="https://rxmarbles.com/" target="_blank">https://rxmarbles.com/</a>
                            </li>
                            <li>
                                <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequestEventTarget/onprogress" target="_blank"
                                    >https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequestEventTarget/onprogress</a
                                >
                            </li>
                            <li>
                                <a href="https://developers.google.com/web/updates/2015/03/introduction-to-fetch" target="_blank"
                                    >https://developers.google.com/web/updates/2015/03/introduction-to-fetch</a
                                >
                            </li>
                            <li>
                                <a href="https://clojure.org/reference/transducers" target="_blank">https://clojure.org/reference/transducers</a>
                            </li>
                        </ul>
                    </section>
                </section>

                <!-- This is the end -->
                <section data-background-image="./images/skyfall.jpg" data-background-size="cover" data-background-position="0% 0%">
                    <h2 class="c-title--white">This is the end</h2>
                </section>

                <section data-background-image="./images/4k-wallpaper-beautiful-bloom-1263986.jpg" data-background-size="cover" data-background-position="50% 50%">
                    <h2 class="c-title--white">What are your thoughts?</h2>
                </section>

                <section data-background-image="./images/hugh_grant-dancing.webp" data-background-size="contain" data-background-position="50% 50%">
                    <h2 class="c-title--white">Many thanks</h2>
                </section>
            </div>
        </div>
    </body>
</html>
